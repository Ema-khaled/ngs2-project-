Create the conda env if you have not already did
conda create -y --name project python=3.6
conda activate ngs1 
mkdir -p ~/NGS2_Project/first_sample_data && cd ~/NGS2_Project/first_sample_data

Downloading data
#coudnt dowenlode our samples using that link  https://trace.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?study=SRP170630 
then from sra as sra format and then convert it to fastq 

#to  dowenlode sra samples  then convert it to fastaq (paired) 
 conda install -c bioconda sra-tools 
 prefetch SRR8241115  
 fastq-dump SRR8241115
# apear just one fastaq file  
# search on Biostar for that issue resulting after several terying to use thi code  using that link  https://www.biostars.org/p/376434/
 
fastq-dump --split-files SRR8241115 
# so i downlode the samples again from  sra data acess with 2 links 
# and convert it also to fastaq using fastq-dump  


#download sample
#wget https://www.ncbi.nlm.nih.gov//biosample/SAMN10474016/101228_I433_FC812MDABXX_L8_HUMrmoXDTABAPEI-1_1.clean.fq.gz
#wget https://sra-download.st-va.ncbi.nlm.nih.gov/sos2/sra-pub-run-3/SRR8241115/SRR8241115.1

#download reference
#wget https://www.ncbi.nlm.nih.gov/assembly/37871
#downloade (whole  exome reference)  
 wget ftp://ftp.ensembl.org/pub/release-99/fasta/homo_sapiens/cds/Homo_sapiens.GRCh38.cds.all.fa.gz 
 gunzip Homo_sapiens.GRCh38.cds.all.fa.gz
 
 ........................................................
 mkdir -p ~/NGS2_Project/blast_align/blastIndex && cd ~/NGS2_Project/blast_align/blastIndex
 ln -s ~/NGS2_Project/first_sample_data/Homo_sapiens.GRCh38.cds.all.fa .
  ...............................................................................
   explore sample 
   head SRR8241115_1.fastq 
@SRR8241115.1.1 B812MDABXX:8:1:3839:183285 length=90
TTTTTTATGGAAGGGGTGCGGACACATCTCCAATATCCAATTTTATAATGTTTCATTAAGAAAATAGGATTTTCGTGACAGGGTTTAAAC
+SRR8241115.1.1 B812MDABXX:8:1:3839:183285 length=90
FFFFFFFFFEFFFFFF*D:BACDDCFDFECFFE;BDFEAFBFFFEEBFFE?FF0:>A7A?AF;ED@*AA,>7<7;;;>B###########
@SRR8241115.2.1 B812MDABXX:8:1:3921:183304 length=90

   
   
   
   .................................................................................
  mkdir -p ~/NGS2_Project/GATK_tutorial && cd ~/NGS2_Project/GATK_tutorial
for R1 in ~/NGS2_Project/first_sample_data/*_R1.fastq ;do
    SM= Proband II-1                                                              ##sample ID
    LB= HUMrmoXDTABAPEI-1                                                         ##library ID
    PL="Illumina"                                                               ##platform (e.g. illumina, solid)
    RGID=$(cat $R1 | head -n1 | sed 's/:/_/g' |cut -d "_" -f1,2,3,4)           ##read group identifier 
    PU=$RGID.$LB                                                                ##Platform Unit
    echo -e "@RG\tID:$RGID\tSM:$SM\tPL:$PL\tLB:$LB\tPU:$PU"

    R2=$(echo $R1 | sed 's/_R1./_R2./')
    echo $R1 $R2
    index="$~/NGS2_Project/bwa_align/bwaIndex/Homo_sapiens.GRCh38.cds.all.fa"
    bwa mem -t 4 -M -R "@RG\tID:$RGID\tSM:$SM\tPL:$PL\tLB:$LB\tPU:$PU" $index $R1 $R2 > 101228_I433_FC812MDABXX_HUMrmoXDTABAPEI.sam
    not working 
    
    .............................................
    R1="$HOME/NGS2_Project/first_sample_data/SRR8241116.1_1.fixed.fastq"
    R2="$HOME/NGS2_Project/first_sample_data/SRR8241116.1_2.fixed.fastq"
    index="$HOME/NGS2_Project/bwa_align/bwaIndex/Homo_sapiens.GRCh38.cds.all.fa"
    SM="Proband II-1"
    LB="HUMrmoXDTABAPEI-1"
    PL="Illumina"
    RGID="FC812MDABXX"
    PU=$RGID.$LB
     bwa mem -t 4 -M -R "@RG\tID:$RGID\tSM:$SM\tPL:$PL\tLB:$LB\tPU:$PU" $index $R1 $R2 > 101228_I433_FC812MDABXX_HUMrmoXDTABAPEI.sam
     this code is working 
     ............................................................
     for samfile in *.sam;do
  sample=${samfile%.sam}
  samtools view -hbo $sample.bam $samfile
  samtools sort $sample.bam -o $sample.sorted.bam
done
...........................................................
# Install Picard tools
conda install -c bioconda picard 
picard_path=$CONDA_PREFIX/share/picard-* ## 2.21.7-0


# merge the replicates
java  -Xmx2g -jar $picard_path/picard.jar MergeSamFiles I=BD143_TGACCA_L005.sorted.bam I=BD143_TGACCA_L006.sorted.bam OUTPUT=BD143_TGACCA_merged.sorted.bam

# check for the changes in the header
samtools view -H BD143_TGACCA_L005.sorted.bam
samtools view -H BD143_TGACCA_L006.sorted.bam
samtools view -H BD143_TGACCA_merged.sorted.bam

# remove the individual replicates
rm BD143_TGACCA_L00*.sorted.bam 
 didnt use it 
 ......................................................
 for bamFile in *.sorted.bam;do
  output=${bamFile%.sorted.bam}
  samtools depth $bamFile | awk '{{sum+=$3}} END {{print "Average = ",sum/NR, "No of covered Nuc = ", NR}}' > $output.cov
  samtools flagstat $bamFile > $output.stat
done
#work 
.................................................

#Mark duplicate
for sample in *.sorted.bam;do
  name=${sample%.sorted.bam}
  java  -Xmx2g -jar $picard_path/picard.jar MarkDuplicates INPUT=$sample OUTPUT=$name.dedup.bam METRICS_FILE=$name.metrics.txt;
done 
#work
.................................................................
#Install GATK
conda install -c bioconda gatk4 
indexing
# samples
for sample in *.dedup.bam;do
  #name=${sample%.dedup.bam}
  java -Xmx2g -jar $picard_path/picard.jar BuildBamIndex VALIDATION_STRINGENCY=LENIENT INPUT=$sample
done 
#work 
.......................................................














     
  
  
 
